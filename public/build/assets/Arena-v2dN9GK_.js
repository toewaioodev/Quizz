import{r as u,a as Z,u as ie,j as t,H as pe}from"./app-COnZO-b-.js";import{c as de}from"./compiler-runtime-7OStjCgM.js";import{u as fe,a as ue,b as xe,c as he,d as me,I as ce,e as be,f as we,g as Ne,C as ye,A as ge}from"./ChannelProvider-DAUMD_Un.js";import{u as je,T as ve}from"./ThemeSwitcher-BI8mmqeS.js";/* empty css            */function ke(n,e){const r=typeof n=="object"?n:{channelName:n},o=r.skip,l=fe(r.ablyId),{channel:c}=ue(r.ablyId,r.channelName),{connectionError:f,channelError:a}=xe(r),x=u.useRef(e);u.useEffect(()=>{x.current=e},[e]);const[s,i]=u.useState(c.state);he(r,m=>{i(m.current)});const{connectionState:d}=me(c,r.ablyId,o),w=ce.includes(d)||be.includes(s)||o;return u.useEffect(()=>w?void 0:((async()=>{await c.presence.enter(x.current)})(),()=>{const p=!ce.includes(l.connection.state);["attached","attaching"].includes(c.state)&&p&&c.presence.leave()}),[w,c,l]),{updateStatus:u.useCallback(async m=>{await c.presence.update(m)},[c]),connectionError:f,channelError:a}}function _e(n,e){const r=typeof n=="object"?n:{channelName:n},o=r.skip,{channel:l}=ue(r.ablyId,r.channelName),{connectionError:c,channelError:f}=xe(r),[a,x]=u.useState([]),s=u.useRef(e);u.useEffect(()=>{s.current=e},[e]);const i=u.useCallback(async h=>{var m;const p=await l.presence.get();x(p),(m=s.current)===null||m===void 0||m.call(s,h)},[l.presence]),d=u.useCallback(async()=>{l.presence.subscribe(["enter","leave","update"],i);const h=await l.presence.get();x(h)},[l.presence,i]),w=u.useCallback(async()=>{l.presence.unsubscribe(["enter","leave","update"],i)},[l.presence,i]);return u.useEffect(()=>{if(!o)return d(),()=>{w()}},[o,d,w]),me(l,r.ablyId,o),{presenceData:a,connectionError:c,channelError:f}}const Ee={status:"WAITING_FOR_OPPONENT",currentQuestion:null,timer:0,playerScores:{p1:0,p2:0},lastRoundResult:null,winnerId:null,opponentAnswered:!1,hasAnswered:!1,opponent:null};function Re(n,e){switch(e.type){case"MATCH_FOUND":return{...n,status:"STARTING",opponent:e.payload.opponent};case"GAME_START":return{...n,status:"STARTING"};case"NEW_QUESTION":return{...n,status:"QUESTION_ACTIVE",currentQuestion:e.payload,timer:e.payload.time_limit,hasAnswered:!1,opponentAnswered:!1,lastRoundResult:null};case"TICK_TIMER":return{...n,timer:Math.max(n.timer-1,0)};case"OPPONENT_ANSWERED":return{...n,opponentAnswered:!0};case"PLAYER_ANSWERED":return{...n,hasAnswered:!0};case"ROUND_RESULT":return{...n,status:"ROUND_RESULT",lastRoundResult:e.payload,playerScores:e.payload.player_scores};case"GAME_OVER":return{...n,status:"GAME_OVER",winnerId:e.payload.winner_id,playerScores:e.payload.final_scores};default:return n}}function Se(n,e,r,o){const[l,c]=u.useReducer(Re,Ee);we(`match:${e}`,s=>{switch(console.log("Event:",s.name,s.data),s.name){case"match-found":c({type:"MATCH_FOUND",payload:s.data});break;case"match:start":c({type:"GAME_START",payload:s.data});break;case"game:question":c({type:"NEW_QUESTION",payload:s.data});break;case"game:answered":s.data.clientId!==String(r)&&c({type:"OPPONENT_ANSWERED"});break;case"game:round_result":c({type:"ROUND_RESULT",payload:s.data}),o&&setTimeout(()=>x(),3e3);break;case"game:over":c({type:"GAME_OVER",payload:s.data});break}}),u.useEffect(()=>{let s;return l.status==="QUESTION_ACTIVE"&&l.timer>0&&(s=setInterval(()=>{c({type:"TICK_TIMER"})},1e3)),()=>clearInterval(s)},[l.status,l.timer]),u.useEffect(()=>{(async()=>{try{const d=(await Z.get(`/match/${n}/state`)).data;if(d.status==="active"&&d.currentQuestion){const w=Math.floor(Date.now()/1e3),h=d.currentQuestion.sent_at,m=w-h,p=Math.max(d.currentQuestion.time_limit-m,0);c({type:"NEW_QUESTION",payload:{...d.currentQuestion,time_limit:p}}),d.playerScores}}catch(i){console.error("Failed to sync state",i)}})()},[n]);const f=async()=>{try{await Z.post(`/match/${n}/start`)}catch(s){console.error(s)}},a=async s=>{if(!l.hasAnswered){c({type:"PLAYER_ANSWERED"});try{await Z.post(`/match/${n}/answer`,{question_id:l.currentQuestion?.question_id,answer_option:s})}catch(i){console.error(i)}}},x=async()=>{try{await Z.post(`/match/${n}/next`)}catch(s){console.error(s)}};return{state:l,startGame:f,submitAnswer:a,nextQuestion:x}}function Pe(n){const e=de.c(11),{match:r,ably_key:o}=n,l=ie().props.auth.user,c=String(l.id);let f;e[0]!==o||e[1]!==c?(f=new Ne.Realtime({key:o,clientId:c}),e[0]=o,e[1]=c,e[2]=f):f=e[2];const a=f,x=`match:${r.channel_id}`;let s;e[3]!==r?(s=t.jsx(Te,{match:r}),e[3]=r,e[4]=s):s=e[4];let i;e[5]!==x||e[6]!==s?(i=t.jsx(ye,{channelName:x,children:s}),e[5]=x,e[6]=s,e[7]=i):i=e[7];let d;return e[8]!==a||e[9]!==i?(d=t.jsx(ge,{client:a,children:i}),e[8]=a,e[9]=i,e[10]=d):d=e[10],d}function Te(n){const e=de.c(96),{match:r}=n,o=ie().props.auth.user,{t:l}=je(),c=r.player1_id===o.id?r.player2:r.player1,f=r.player1_id===o.id,{state:a,submitAnswer:x}=Se(r.id,r.channel_id,o.id,f),s=a.opponent||c;ke(`match:${r.channel_id}`);const{presenceData:i}=_e(`match:${r.channel_id}`),[d,w]=u.useState(!1);let h;e[0]!==s?.id||e[1]!==i?(h=()=>{const z=i.some(X=>X.clientId===String(s?.id));w(z)},e[0]=s?.id,e[1]=i,e[2]=h):h=e[2];let m;e[3]!==s||e[4]!==i?(m=[i,s],e[3]=s,e[4]=i,e[5]=m):m=e[5],u.useEffect(h,m);const p=a.timer,b=a.currentQuestion,N=a.playerScores[r.player1_id===o.id?"p1":"p2"],y=a.playerScores[r.player1_id===o.id?"p2":"p1"],ee=a.winnerId===o.id,te=a.status==="GAME_OVER"&&!a.winnerId;let Y;e[6]===Symbol.for("react.memo_cache_sentinel")?(Y=t.jsx(pe,{title:"Arena"}),e[6]=Y):Y=e[6];let B;e[7]===Symbol.for("react.memo_cache_sentinel")?(B=t.jsx("div",{className:"absolute top-4 right-4 z-50 hidden md:block",children:t.jsx(ve,{})}),e[7]=B):B=e[7];let q;e[8]===Symbol.for("react.memo_cache_sentinel")?(q=t.jsxs("div",{className:"pointer-events-none absolute inset-0 overflow-hidden",children:[t.jsx("div",{className:"absolute top-[-10%] left-[-10%] h-[500px] w-[500px] animate-pulse rounded-full bg-blue-500/20 blur-[100px]"}),t.jsx("div",{className:"absolute right-[-10%] bottom-[-10%] h-[500px] w-[500px] animate-pulse rounded-full bg-purple-500/20 blur-[100px] delay-700"})]}),e[8]=q):q=e[8];const se=`flex items-center gap-3 transition-all duration-300 ${N>y?"scale-105":"scale-100"}`;let g;e[9]!==o.name||e[10]!==o.profile_photo_url?(g=t.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full border-2 border-white bg-gradient-to-br from-blue-500 to-blue-700 text-lg font-bold text-white shadow-lg shadow-blue-500/30 md:h-16 md:w-16 md:text-xl dark:border-slate-800 overflow-hidden",children:t.jsx("img",{src:o.profile_photo_url,alt:o.name,className:"w-full h-full object-cover"})}),e[9]=o.name,e[10]=o.profile_photo_url,e[11]=g):g=e[11];let K;e[12]===Symbol.for("react.memo_cache_sentinel")?(K=t.jsx("div",{className:"absolute -right-1 -bottom-1 rounded-full border border-white bg-slate-900 px-1.5 py-0.5 text-[10px] font-bold text-white md:text-xs dark:border-slate-800",children:"YOU"}),e[12]=K):K=e[12];let j;e[13]!==g?(j=t.jsxs("div",{className:"relative",children:[g,K]}),e[13]=g,e[14]=j):j=e[14];let v;e[15]!==o.name?(v=t.jsx("span",{className:"max-w-[80px] truncate text-sm font-bold md:max-w-[150px] md:text-lg",children:o.name}),e[15]=o.name,e[16]=v):v=e[16];let k;e[17]!==N?(k=t.jsx("span",{className:"text-xl leading-none font-black text-blue-600 md:text-3xl dark:text-blue-400",children:N}),e[17]=N,e[18]=k):k=e[18];let _;e[19]!==v||e[20]!==k?(_=t.jsxs("div",{className:"flex flex-col",children:[v,k]}),e[19]=v,e[20]=k,e[21]=_):_=e[21];let E;e[22]!==_||e[23]!==se||e[24]!==j?(E=t.jsxs("div",{className:se,children:[j,_]}),e[22]=_,e[23]=se,e[24]=j,e[25]=E):E=e[25];let R;e[26]!==a.status||e[27]!==l||e[28]!==p?(R=a.status==="QUESTION_ACTIVE"||a.status==="ROUND_RESULT"?t.jsxs("div",{className:`relative flex h-16 w-16 items-center justify-center rounded-full border-4 shadow-xl transition-all duration-300 md:h-20 md:w-20 ${p<=5?"scale-110 border-red-500 bg-red-500/10":"border-white bg-white dark:border-slate-700 dark:bg-slate-800"}`,children:[t.jsx("span",{className:`text-2xl font-black md:text-4xl ${p<=5?"text-red-500":"text-slate-800 dark:text-white"}`,children:p}),t.jsxs("svg",{className:"pointer-events-none absolute inset-0 h-full w-full -rotate-90",viewBox:"0 0 100 100",children:[t.jsx("circle",{className:"stroke-current text-slate-200 opacity-20 dark:text-slate-700",strokeWidth:"8",cx:"50",cy:"50",r:"40",fill:"transparent"}),t.jsx("circle",{className:`stroke-current transition-all duration-1000 ease-linear ${p<=5?"text-red-500":"text-blue-500"}`,strokeWidth:"8",strokeLinecap:"round",cx:"50",cy:"50",r:"40",fill:"transparent",strokeDasharray:"251.2",strokeDashoffset:251.2-251.2*p/15})]})]}):t.jsx("div",{className:"text-2xl font-black text-slate-300 italic md:text-4xl dark:text-slate-700",children:a.status==="STARTING"?"VS":a.status==="WAITING_FOR_OPPONENT"?l("WAITING"):""}),e[26]=a.status,e[27]=l,e[28]=p,e[29]=R):R=e[29];let S;e[30]!==b||e[31]!==l?(S=b?`${l("Round")} ${b.round_index}/5`:"",e[30]=b,e[31]=l,e[32]=S):S=e[32];let T;e[33]!==S?(T=t.jsx("div",{className:"mt-1 text-[10px] font-bold tracking-widest text-slate-400 uppercase md:text-xs",children:S}),e[33]=S,e[34]=T):T=e[34];let A;e[35]!==R||e[36]!==T?(A=t.jsxs("div",{className:"flex flex-col items-center",children:[R,T]}),e[35]=R,e[36]=T,e[37]=A):A=e[37];const ae=`flex flex-row-reverse items-center gap-3 text-right transition-all duration-300 ${y>N?"scale-105":"scale-100"}`,le=`flex h-12 w-12 items-center justify-center rounded-full border-2 border-white text-lg font-bold text-white shadow-lg md:h-16 md:w-16 md:text-xl dark:border-slate-800 overflow-hidden ${s?"bg-gradient-to-br from-red-500 to-red-700 shadow-red-500/30":"animate-pulse bg-slate-300 dark:bg-slate-800"}`;let I;e[38]!==s?(I=s?t.jsx("img",{src:s.profile_photo_url||`https://ui-avatars.com/api/?name=${s.name}&color=7F9CF5&background=EBF4FF`,alt:s.name,className:"w-full h-full object-cover"}):"?",e[38]=s,e[39]=I):I=e[39];let C;e[40]!==le||e[41]!==I?(C=t.jsx("div",{className:le,children:I}),e[40]=le,e[41]=I,e[42]=C):C=e[42];let O;e[43]!==s||e[44]!==d?(O=s&&t.jsx("div",{className:`absolute -bottom-0 -left-0 h-4 w-4 rounded-full border-2 border-white dark:border-slate-800 ${d?"bg-green-500":"bg-gray-400"}`}),e[43]=s,e[44]=d,e[45]=O):O=e[45];let U;e[46]!==C||e[47]!==O?(U=t.jsxs("div",{className:"relative",children:[C,O]}),e[46]=C,e[47]=O,e[48]=U):U=e[48];let D;e[49]!==s||e[50]!==l?(D=s?s.name:l("..."),e[49]=s,e[50]=l,e[51]=D):D=e[51];let P;e[52]!==D?(P=t.jsx("span",{className:"max-w-[80px] truncate text-sm font-bold md:max-w-[150px] md:text-lg",children:D}),e[52]=D,e[53]=P):P=e[53];let $;e[54]!==y?($=t.jsx("span",{className:"text-xl leading-none font-black text-red-500 md:text-3xl dark:text-red-400",children:y}),e[54]=y,e[55]=$):$=e[55];let G;e[56]!==P||e[57]!==$?(G=t.jsxs("div",{className:"flex flex-col items-end",children:[P,$]}),e[56]=P,e[57]=$,e[58]=G):G=e[58];let M;e[59]!==ae||e[60]!==U||e[61]!==G?(M=t.jsxs("div",{className:ae,children:[U,G]}),e[59]=ae,e[60]=U,e[61]=G,e[62]=M):M=e[62];let L;e[63]!==E||e[64]!==A||e[65]!==M?(L=t.jsxs("div",{className:"sticky top-0 z-10 mx-auto flex w-full max-w-6xl flex-row items-center justify-between border-b border-slate-200 bg-white/50 p-4 backdrop-blur-sm md:static md:border-none md:bg-transparent dark:border-white/5 dark:bg-black/20",children:[E,A,M]}),e[63]=E,e[64]=A,e[65]=M,e[66]=L):L=e[66];let Q;e[67]!==a.status||e[68]!==l?(Q=a.status==="WAITING_FOR_OPPONENT"&&t.jsxs("div",{className:"animate-in fade-in md:p6 flex flex-1 flex-col items-center justify-center space-y-8 p-4 text-center duration-700 md:p-6",children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"h-24 w-24 rounded-full border-4 border-slate-200 dark:border-slate-800"}),t.jsx("div",{className:"absolute inset-0 h-24 w-24 animate-spin rounded-full border-t-4 border-blue-500"}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("svg",{className:"h-8 w-8 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold md:text-3xl",children:l("Searching for Opponent")}),t.jsx("p",{className:"mt-2 text-slate-500 dark:text-slate-400",children:l("Connecting to global matchmaking server...")})]})]}),e[67]=a.status,e[68]=l,e[69]=Q):Q=e[69];let F;e[70]!==a.status||e[71]!==l?(F=a.status==="STARTING"&&t.jsxs("div",{className:"animate-in zoom-in flex flex-1 flex-col items-center justify-center space-y-6 p-8 text-center duration-500",children:[t.jsx("div",{className:"mb-4 text-6xl md:text-8xl",children:"⚔️"}),t.jsx("h1",{className:"animate-bounce bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-4xl font-black text-transparent md:text-6xl dark:from-blue-400 dark:to-purple-500",children:l("MATCH FOUND!")}),t.jsx("p",{className:"text-xl text-slate-600 dark:text-slate-300",children:l("Get Ready...")})]}),e[70]=a.status,e[71]=l,e[72]=F):F=e[72];let W;e[73]!==b||e[74]!==a.hasAnswered||e[75]!==a.lastRoundResult||e[76]!==a.opponentAnswered||e[77]!==a.status||e[78]!==x||e[79]!==l?(W=(a.status==="QUESTION_ACTIVE"||a.status==="ROUND_RESULT")&&b&&t.jsxs("div",{className:"animate-in slide-in-from-bottom-8 flex flex-1 flex-col space-y-8 p-6 duration-500 md:p-10",children:[t.jsxs("div",{className:"space-y-4 text-center",children:[t.jsx("span",{className:"inline-block rounded-full border border-blue-200 bg-blue-100 px-4 py-1.5 text-xs font-bold tracking-widest text-blue-600 uppercase dark:border-blue-500/20 dark:bg-blue-900/30 dark:text-blue-400",children:b.category}),t.jsx("h2",{className:"text-2xl leading-tight font-bold text-slate-800 md:text-4xl md:leading-tight dark:text-slate-100",children:b.text})]}),t.jsx("div",{className:"mt-auto grid w-full grid-cols-1 gap-3 md:grid-cols-2 md:gap-4",children:b.options.map((z,X)=>{const oe=a.lastRoundResult?.correct_option===z,re=a.status==="ROUND_RESULT";let ne="border-slate-200 bg-white text-slate-700 hover:-translate-y-1 hover:border-blue-500 hover:shadow-lg dark:border-slate-700 dark:bg-slate-800 dark:text-slate-200";return a.hasAnswered&&(ne="border-transparent bg-slate-100 text-slate-400 opacity-50 dark:bg-slate-800/50"),re&&oe&&(ne="scale-[1.02] border-green-600 bg-green-500 text-white shadow-lg shadow-green-500/20 opacity-100"),t.jsx("button",{onClick:()=>x(z),disabled:a.hasAnswered||re,className:`group relative rounded-2xl border-2 p-4 text-left transition-all duration-200 md:p-6 ${ne}`,children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("span",{className:`flex h-8 w-8 items-center justify-center rounded-lg border text-sm font-bold ${re&&oe?"border-white/40 bg-white/20 text-white":"border-slate-200 bg-slate-100 text-slate-500 dark:border-slate-600 dark:bg-slate-700"}`,children:String.fromCharCode(65+X)}),t.jsx("span",{className:"text-lg font-semibold",children:z})]})},X)})}),a.opponentAnswered&&!a.lastRoundResult&&t.jsx("div",{className:"text-center text-sm font-bold text-red-500 animate-pulse",children:l("Opponent has answered!")})]}),e[73]=b,e[74]=a.hasAnswered,e[75]=a.lastRoundResult,e[76]=a.opponentAnswered,e[77]=a.status,e[78]=x,e[79]=l,e[80]=W):W=e[80];let V;e[81]!==te||e[82]!==ee||e[83]!==y||e[84]!==N||e[85]!==a.status||e[86]!==l?(V=a.status==="GAME_OVER"&&t.jsxs("div",{className:"animate-in zoom-in flex flex-1 flex-col items-center justify-center space-y-8 p-8 text-center duration-500",children:[t.jsx("h1",{className:"text-4xl font-black tracking-tight text-slate-900 uppercase md:text-6xl dark:text-white",children:l("GAME OVER")}),t.jsxs("div",{className:"flex w-full items-end justify-center gap-8 md:gap-16",children:[t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:"text-5xl font-black",children:N}),t.jsx("div",{className:"text-sm",children:"YOU"})]}),t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:"text-5xl font-black",children:y}),t.jsx("div",{className:"text-sm",children:"OPPONENT"})]})]}),t.jsx("div",{className:"pt-8 text-3xl font-bold",children:ee?t.jsx("span",{className:"text-green-500",children:"VICTORY!"}):te?t.jsx("span",{className:"text-yellow-500",children:"DRAW"}):t.jsx("span",{className:"text-red-500",children:"DEFEAT"})}),t.jsx("button",{onClick:Ae,className:"rounded-2xl bg-slate-900 px-8 py-4 font-bold text-white shadow-xl hover:scale-105 dark:bg-white dark:text-slate-900",children:l("Back to Dashboard")})]}),e[81]=te,e[82]=ee,e[83]=y,e[84]=N,e[85]=a.status,e[86]=l,e[87]=V):V=e[87];let H;e[88]!==Q||e[89]!==F||e[90]!==W||e[91]!==V?(H=t.jsx("div",{className:"z-10 flex w-full max-w-4xl flex-1 flex-col justify-center p-2 md:p-4",children:t.jsxs("div",{className:"relative flex min-h-[400px] flex-col overflow-hidden rounded-3xl border border-slate-200 bg-white/80 shadow-2xl backdrop-blur-xl transition-all duration-500 md:min-h-[500px] dark:border-white/10 dark:bg-slate-900/60",children:[Q,F,W,V]})}),e[88]=Q,e[89]=F,e[90]=W,e[91]=V,e[92]=H):H=e[92];let J;return e[93]!==L||e[94]!==H?(J=t.jsxs("div",{className:"relative flex min-h-screen flex-col items-center overflow-hidden bg-slate-50 font-sans text-slate-900 transition-colors duration-300 selection:bg-blue-500 selection:text-white dark:bg-slate-950 dark:text-white",children:[Y,B,q,L,H]}),e[93]=L,e[94]=H,e[95]=J):J=e[95],J}function Ae(){return window.location.href="/dashboard"}export{Pe as default};
