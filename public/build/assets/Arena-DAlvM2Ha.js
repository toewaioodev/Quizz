import{u as E,j as e,r as o,H as G,a as A}from"./app-C6qbjlrG.js";import{c as Q}from"./compiler-runtime-LW97XJ8l.js";import{a as D,C as H,A as M,u as z,b as V}from"./ChannelProvider-ywI7VuVu.js";import{u as F}from"./useTranslation-C11qvto0.js";/* empty css            */function J(d){const s=Q.c(11),{match:a,ably_key:b}=d,N=E().props.auth.user,p=String(N.id);let i;s[0]!==b||s[1]!==p?(i=new D.Realtime({key:b,clientId:p}),s[0]=b,s[1]=p,s[2]=i):i=s[2];const g=i,c=`match:${a.channel_id}`;let x;s[3]!==a?(x=e.jsx(Y,{match:a}),s[3]=a,s[4]=x):x=s[4];let l;s[5]!==c||s[6]!==x?(l=e.jsx(H,{channelName:c,children:x}),s[5]=c,s[6]=x,s[7]=l):l=s[7];let h;return s[8]!==g||s[9]!==l?(h=e.jsx(M,{client:g,children:l}),s[8]=g,s[9]=l,s[10]=h):h=s[10],h}function Y({match:d}){const s=E().props.auth.user,[a,b]=o.useState("waiting"),[N,p]=o.useState([]),[i,g]=o.useState(d.player1_id===s.id?d.player2:d.player1),[c,x]=o.useState(null),[l,h]=o.useState(5),[u,q]=o.useState(0),[m,C]=o.useState(0),[j,v]=o.useState(!1),[y,S]=o.useState(!1),[_,T]=o.useState(0),{t:n,i18n:O}=F(),{channel:w}=z(`match:${d.channel_id}`,t=>{t.name==="match-found"?(b("starting"),t.data.opponent&&g(t.data.opponent),setTimeout(()=>P(),3e3)):t.name==="new-question"?(x(t.data),h(15),v(!1),S(!1),b("question"),T(r=>r+1)):t.name==="score-update"?t.clientId!==String(s.id)&&C(r=>r+t.data.points):t.name==="player-answered"?t.clientId!==String(s.id)&&S(!0):t.name==="game-over"&&b("result"),p(r=>[...r,t])});V(t=>{console.log("Ably connection state:",t.current)});const f=d.player1_id===s.id,P=async()=>{f&&await k()},k=async()=>{if(_>=5){I();return}try{const t=await A.post("/quiz/generate",{topic:"Science",difficulty:"medium",language:O.language});w.publish("new-question",t.data)}catch(t){console.error("Quiz Error",t)}},I=async()=>{w.publish("game-over",{});let t=null;if(u>m?t=s.id:m>u&&(t=i.id),f)try{await A.post("/match/end",{match_id:d.id,winner_id:t})}catch(r){console.error("End Match Error",r)}};o.useEffect(()=>{let t;return a==="question"&&l>0?t=setInterval(()=>h(r=>r-1),1e3):a==="question"&&l===0&&f&&k(),()=>clearInterval(t)},[a,l,f]),o.useEffect(()=>{if(a==="question"&&j&&y&&f){const t=setTimeout(()=>{k()},1e3);return()=>clearTimeout(t)}},[a,j,y,f]);const R=t=>{if(!j&&(v(!0),w.publish("player-answered",{}),t===c?.correct_answer)){const r=l*10;q($=>$+r),w.publish("score-update",{points:r})}};return e.jsxs("div",{className:"min-h-screen bg-slate-100 dark:bg-black text-slate-900 dark:text-white p-6 flex flex-col items-center font-sans selection:bg-blue-500 selection:text-white transition-colors duration-300",children:[e.jsx(G,{title:"Arena"}),e.jsxs("div",{className:"max-w-4xl w-full flex justify-between items-center mb-12",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-600 flex items-center justify-center text-xl font-bold mb-2 shadow-[0_0_30px_rgba(37,99,235,0.6)] border-2 border-blue-400",children:s.name.charAt(0)}),e.jsx("span",{className:"font-bold text-lg",children:s.name}),e.jsx("span",{className:"text-4xl font-black text-blue-400 mt-2",children:u})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-6xl font-black italic tracking-tighter text-slate-800 drop-shadow-sm",children:"VS"}),a==="question"&&e.jsxs("div",{className:"mt-4 text-2xl font-mono font-bold text-yellow-400 animate-pulse",children:["00:",l<10?`0${l}`:l]}),a==="question"&&e.jsxs("div",{className:"text-sm text-slate-500 mt-2",children:[n("Round")," ",_,"/5"]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[i?e.jsx("div",{className:"w-16 h-16 rounded-full bg-red-600 flex items-center justify-center text-xl font-bold mb-2 shadow-[0_0_30px_rgba(220,38,38,0.6)] border-2 border-red-400",children:i.name?i.name.charAt(0):"?"}):e.jsx("div",{className:"w-16 h-16 rounded-full bg-slate-800 flex items-center justify-center text-xl font-bold mb-2 animate-pulse border border-slate-700",children:"?"}),e.jsx("span",{className:"font-bold text-lg",children:i?i.name:n("Searching...")}),e.jsx("span",{className:"text-4xl font-black text-red-400 mt-2",children:m})]})]}),e.jsxs("div",{className:"w-full max-w-3xl bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border border-slate-200 dark:border-slate-700/50 rounded-3xl p-8 min-h-[400px] flex flex-col items-center justify-center relative shadow-2xl transition-colors duration-300",children:[a==="waiting"&&!i&&e.jsxs("div",{className:"text-center space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 border-t-4 border-l-4 border-blue-500 rounded-full animate-spin mx-auto"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 bg-blue-500/20 rounded-full blur-xl"})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight text-slate-800 dark:text-white",children:n("Searching for Opponent")}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-2",children:n("Connecting to global matchmaking server...")})]})]}),a==="starting"&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("h1",{className:"text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-400 dark:to-purple-600 animate-bounce",children:n("MATCH FOUND!")}),e.jsx("p",{className:"text-xl text-slate-600 dark:text-slate-300",children:n("Preparing battle...")})]}),a==="question"&&c&&e.jsxs("div",{className:"w-full space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-500/10 text-blue-600 dark:text-blue-400 text-xs font-bold uppercase tracking-widest rounded-full border border-blue-500/20",children:c.category||n("General Knowledge")}),e.jsx("h2",{className:"text-3xl font-bold leading-tight md:text-4xl text-slate-900 dark:text-white",children:c.question_text})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 w-full",children:c.options.map((t,r)=>e.jsx("button",{onClick:()=>R(t),disabled:j,className:`
                                        p-6 rounded-xl border-2 text-lg font-semibold transition-all duration-200
                                        ${j?t===c.correct_answer?"bg-green-500/20 border-green-500 text-green-700 dark:text-green-400":"bg-slate-200 dark:bg-slate-800/50 border-slate-300 dark:border-slate-700 text-slate-400 dark:text-slate-500 opacity-50":"bg-white dark:bg-slate-800/50 border-slate-200 dark:border-slate-700 hover:border-blue-500 hover:bg-slate-50 dark:hover:bg-slate-800 hover:scale-[1.02] active:scale-[0.98] text-slate-800 dark:text-white"}
                                    `,children:t},r))})]}),a==="result"&&e.jsxs("div",{className:"text-center space-y-8 animate-in zoom-in duration-300",children:[e.jsx("h1",{className:"text-5xl font-black text-slate-900 dark:text-white",children:n("GAME OVER")}),e.jsxs("div",{className:"flex justify-center gap-12",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm uppercase font-bold",children:n("You")}),e.jsx("p",{className:`text-6xl font-black ${u>m?"text-green-600 dark:text-green-400":"text-slate-700 dark:text-slate-200"}`,children:u})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm uppercase font-bold",children:n("Opponent")}),e.jsx("p",{className:`text-6xl font-black ${m>u?"text-green-600 dark:text-green-400":"text-slate-700 dark:text-slate-200"}`,children:m})]})]}),e.jsx("div",{className:"text-2xl font-bold",children:u>m?e.jsx("span",{className:"text-green-600 dark:text-green-400",children:n("VICTORY! +50 PTS")}):u<m?e.jsx("span",{className:"text-red-500 dark:text-red-400",children:n("DEFEAT -10 PTS")}):e.jsx("span",{className:"text-yellow-500 dark:text-yellow-400",children:n("DRAW")})}),e.jsx("button",{onClick:()=>window.location.href="/dashboard",className:"px-8 py-3 bg-slate-900 dark:bg-white text-white dark:text-slate-900 font-bold rounded-xl hover:bg-slate-800 dark:hover:bg-slate-200 transition-colors",children:n("Back to Dashboard")})]})]})]})}export{J as default};
