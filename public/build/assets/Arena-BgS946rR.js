import{r as x,a as Z,u as ie,j as t,H as pe}from"./app-C9juYcmM.js";import{c as de}from"./compiler-runtime-ByB3rLD-.js";import{u as fe,a as ue,b as xe,c as he,d as me,I as ce,e as be,f as Ne,g as we,C as ye,A as ge}from"./ChannelProvider-hKJIHm_H.js";import{u as je,T as ve}from"./ThemeSwitcher-B8JRBI3v.js";/* empty css            */function ke(c,e){const r=typeof c=="object"?c:{channelName:c},o=r.skip,a=fe(r.ablyId),{channel:i}=ue(r.ablyId,r.channelName),{connectionError:n,channelError:f}=xe(r),s=x.useRef(e);x.useEffect(()=>{s.current=e},[e]);const[l,d]=x.useState(i.state);he(r,m=>{d(m.current)});const{connectionState:u}=me(i,r.ablyId,o),N=ce.includes(u)||be.includes(l)||o;return x.useEffect(()=>N?void 0:((async()=>{await i.presence.enter(s.current)})(),()=>{const p=!ce.includes(a.connection.state);["attached","attaching"].includes(i.state)&&p&&i.presence.leave()}),[N,i,a]),{updateStatus:x.useCallback(async m=>{await i.presence.update(m)},[i]),connectionError:n,channelError:f}}function _e(c,e){const r=typeof c=="object"?c:{channelName:c},o=r.skip,{channel:a}=ue(r.ablyId,r.channelName),{connectionError:i,channelError:n}=xe(r),[f,s]=x.useState([]),l=x.useRef(e);x.useEffect(()=>{l.current=e},[e]);const d=x.useCallback(async h=>{var m;const p=await a.presence.get();s(p),(m=l.current)===null||m===void 0||m.call(l,h)},[a.presence]),u=x.useCallback(async()=>{a.presence.subscribe(["enter","leave","update"],d);const h=await a.presence.get();s(h)},[a.presence,d]),N=x.useCallback(async()=>{a.presence.unsubscribe(["enter","leave","update"],d)},[a.presence,d]);return x.useEffect(()=>{if(!o)return u(),()=>{N()}},[o,u,N]),me(a,r.ablyId,o),{presenceData:f,connectionError:i,channelError:n}}const Ee={status:"WAITING_FOR_OPPONENT",currentQuestion:null,timer:0,playerScores:{p1:0,p2:0},lastRoundResult:null,winnerId:null,opponentAnswered:!1,hasAnswered:!1};function Se(c,e){switch(e.type){case"MATCH_FOUND":return{...c,status:"STARTING"};case"GAME_START":return{...c,status:"STARTING"};case"NEW_QUESTION":return{...c,status:"QUESTION_ACTIVE",currentQuestion:e.payload,timer:e.payload.time_limit,hasAnswered:!1,opponentAnswered:!1,lastRoundResult:null};case"TICK_TIMER":return{...c,timer:Math.max(c.timer-1,0)};case"OPPONENT_ANSWERED":return{...c,opponentAnswered:!0};case"PLAYER_ANSWERED":return{...c,hasAnswered:!0};case"ROUND_RESULT":return{...c,status:"ROUND_RESULT",lastRoundResult:e.payload,playerScores:e.payload.player_scores};case"GAME_OVER":return{...c,status:"GAME_OVER",winnerId:e.payload.winner_id,playerScores:e.payload.final_scores};default:return c}}function Re(c,e,r,o){const[a,i]=x.useReducer(Se,Ee);Ne(`match:${e}`,l=>{switch(console.log("Event:",l.name,l.data),l.name){case"match-found":i({type:"MATCH_FOUND"}),o&&setTimeout(()=>n(),2e3);break;case"match:start":i({type:"GAME_START",payload:l.data});break;case"game:question":i({type:"NEW_QUESTION",payload:l.data});break;case"game:answered":l.data.clientId!==String(r)&&i({type:"OPPONENT_ANSWERED"});break;case"game:round_result":i({type:"ROUND_RESULT",payload:l.data}),o&&setTimeout(()=>s(),3e3);break;case"game:over":i({type:"GAME_OVER",payload:l.data});break}}),x.useEffect(()=>{let l;return a.status==="QUESTION_ACTIVE"&&a.timer>0&&(l=setInterval(()=>{i({type:"TICK_TIMER"})},1e3)),()=>clearInterval(l)},[a.status,a.timer]),x.useEffect(()=>{(async()=>{try{const u=(await Z.get(`/match/${c}/state`)).data;if(u.status==="active"&&u.currentQuestion){const N=Math.floor(Date.now()/1e3),h=u.currentQuestion.sent_at,m=N-h,p=Math.max(u.currentQuestion.time_limit-m,0);i({type:"NEW_QUESTION",payload:{...u.currentQuestion,time_limit:p}}),u.playerScores}}catch(d){console.error("Failed to sync state",d)}})()},[c]);const n=async()=>{try{await Z.post(`/match/${c}/start`)}catch(l){console.error(l)}},f=async l=>{if(!a.hasAnswered){i({type:"PLAYER_ANSWERED"});try{await Z.post(`/match/${c}/answer`,{question_id:a.currentQuestion?.question_id,answer_option:l})}catch(d){console.error(d)}}},s=async()=>{try{await Z.post(`/match/${c}/next`)}catch(l){console.error(l)}};return{state:a,startGame:n,submitAnswer:f,nextQuestion:s}}function Pe(c){const e=de.c(11),{match:r,ably_key:o}=c,a=ie().props.auth.user,i=String(a.id);let n;e[0]!==o||e[1]!==i?(n=new we.Realtime({key:o,clientId:i}),e[0]=o,e[1]=i,e[2]=n):n=e[2];const f=n,s=`match:${r.channel_id}`;let l;e[3]!==r?(l=t.jsx(Te,{match:r}),e[3]=r,e[4]=l):l=e[4];let d;e[5]!==s||e[6]!==l?(d=t.jsx(ye,{channelName:s,children:l}),e[5]=s,e[6]=l,e[7]=d):d=e[7];let u;return e[8]!==f||e[9]!==d?(u=t.jsx(ge,{client:f,children:d}),e[8]=f,e[9]=d,e[10]=u):u=e[10],u}function Te(c){const e=de.c(95),{match:r}=c,o=ie().props.auth.user,{t:a}=je(),i=r.player1_id===o.id?r.player2:r.player1,[n]=x.useState(i),f=r.player1_id===o.id,{state:s,submitAnswer:l}=Re(r.id,r.channel_id,o.id,f);ke(`match:${r.channel_id}`);const{presenceData:d}=_e(`match:${r.channel_id}`),[u,N]=x.useState(!1);let h,m;e[0]!==n||e[1]!==d||e[2]!==s.status?(h=()=>{s.status;const z=d.some(X=>X.clientId===String(n?.id));N(z)},m=[d,n,s.status],e[0]=n,e[1]=d,e[2]=s.status,e[3]=h,e[4]=m):(h=e[3],m=e[4]),x.useEffect(h,m);const p=s.timer,b=s.currentQuestion,w=s.playerScores[r.player1_id===o.id?"p1":"p2"],y=s.playerScores[r.player1_id===o.id?"p2":"p1"],ee=s.winnerId===o.id,te=s.status==="GAME_OVER"&&!s.winnerId;let Y;e[5]===Symbol.for("react.memo_cache_sentinel")?(Y=t.jsx(pe,{title:"Arena"}),e[5]=Y):Y=e[5];let B;e[6]===Symbol.for("react.memo_cache_sentinel")?(B=t.jsx("div",{className:"absolute top-4 right-4 z-50 hidden md:block",children:t.jsx(ve,{})}),e[6]=B):B=e[6];let q;e[7]===Symbol.for("react.memo_cache_sentinel")?(q=t.jsxs("div",{className:"pointer-events-none absolute inset-0 overflow-hidden",children:[t.jsx("div",{className:"absolute top-[-10%] left-[-10%] h-[500px] w-[500px] animate-pulse rounded-full bg-blue-500/20 blur-[100px]"}),t.jsx("div",{className:"absolute right-[-10%] bottom-[-10%] h-[500px] w-[500px] animate-pulse rounded-full bg-purple-500/20 blur-[100px] delay-700"})]}),e[7]=q):q=e[7];const se=`flex items-center gap-3 transition-all duration-300 ${w>y?"scale-105":"scale-100"}`;let g;e[8]!==o.name||e[9]!==o.profile_photo_url?(g=t.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full border-2 border-white bg-gradient-to-br from-blue-500 to-blue-700 text-lg font-bold text-white shadow-lg shadow-blue-500/30 md:h-16 md:w-16 md:text-xl dark:border-slate-800 overflow-hidden",children:t.jsx("img",{src:o.profile_photo_url,alt:o.name,className:"w-full h-full object-cover"})}),e[8]=o.name,e[9]=o.profile_photo_url,e[10]=g):g=e[10];let K;e[11]===Symbol.for("react.memo_cache_sentinel")?(K=t.jsx("div",{className:"absolute -right-1 -bottom-1 rounded-full border border-white bg-slate-900 px-1.5 py-0.5 text-[10px] font-bold text-white md:text-xs dark:border-slate-800",children:"YOU"}),e[11]=K):K=e[11];let j;e[12]!==g?(j=t.jsxs("div",{className:"relative",children:[g,K]}),e[12]=g,e[13]=j):j=e[13];let v;e[14]!==o.name?(v=t.jsx("span",{className:"max-w-[80px] truncate text-sm font-bold md:max-w-[150px] md:text-lg",children:o.name}),e[14]=o.name,e[15]=v):v=e[15];let k;e[16]!==w?(k=t.jsx("span",{className:"text-xl leading-none font-black text-blue-600 md:text-3xl dark:text-blue-400",children:w}),e[16]=w,e[17]=k):k=e[17];let _;e[18]!==v||e[19]!==k?(_=t.jsxs("div",{className:"flex flex-col",children:[v,k]}),e[18]=v,e[19]=k,e[20]=_):_=e[20];let E;e[21]!==_||e[22]!==se||e[23]!==j?(E=t.jsxs("div",{className:se,children:[j,_]}),e[21]=_,e[22]=se,e[23]=j,e[24]=E):E=e[24];let S;e[25]!==s.status||e[26]!==a||e[27]!==p?(S=s.status==="QUESTION_ACTIVE"||s.status==="ROUND_RESULT"?t.jsxs("div",{className:`relative flex h-16 w-16 items-center justify-center rounded-full border-4 shadow-xl transition-all duration-300 md:h-20 md:w-20 ${p<=5?"scale-110 border-red-500 bg-red-500/10":"border-white bg-white dark:border-slate-700 dark:bg-slate-800"}`,children:[t.jsx("span",{className:`text-2xl font-black md:text-4xl ${p<=5?"text-red-500":"text-slate-800 dark:text-white"}`,children:p}),t.jsxs("svg",{className:"pointer-events-none absolute inset-0 h-full w-full -rotate-90",viewBox:"0 0 100 100",children:[t.jsx("circle",{className:"stroke-current text-slate-200 opacity-20 dark:text-slate-700",strokeWidth:"8",cx:"50",cy:"50",r:"40",fill:"transparent"}),t.jsx("circle",{className:`stroke-current transition-all duration-1000 ease-linear ${p<=5?"text-red-500":"text-blue-500"}`,strokeWidth:"8",strokeLinecap:"round",cx:"50",cy:"50",r:"40",fill:"transparent",strokeDasharray:"251.2",strokeDashoffset:251.2-251.2*p/15})]})]}):t.jsx("div",{className:"text-2xl font-black text-slate-300 italic md:text-4xl dark:text-slate-700",children:s.status==="STARTING"?"VS":s.status==="WAITING_FOR_OPPONENT"?a("WAITING"):""}),e[25]=s.status,e[26]=a,e[27]=p,e[28]=S):S=e[28];let R;e[29]!==b||e[30]!==a?(R=b?`${a("Round")} ${b.round_index}/5`:"",e[29]=b,e[30]=a,e[31]=R):R=e[31];let T;e[32]!==R?(T=t.jsx("div",{className:"mt-1 text-[10px] font-bold tracking-widest text-slate-400 uppercase md:text-xs",children:R}),e[32]=R,e[33]=T):T=e[33];let A;e[34]!==S||e[35]!==T?(A=t.jsxs("div",{className:"flex flex-col items-center",children:[S,T]}),e[34]=S,e[35]=T,e[36]=A):A=e[36];const ae=`flex flex-row-reverse items-center gap-3 text-right transition-all duration-300 ${y>w?"scale-105":"scale-100"}`,le=`flex h-12 w-12 items-center justify-center rounded-full border-2 border-white text-lg font-bold text-white shadow-lg md:h-16 md:w-16 md:text-xl dark:border-slate-800 overflow-hidden ${n?"bg-gradient-to-br from-red-500 to-red-700 shadow-red-500/30":"animate-pulse bg-slate-300 dark:bg-slate-800"}`;let I;e[37]!==n?(I=n?t.jsx("img",{src:n.profile_photo_url||`https://ui-avatars.com/api/?name=${n.name}&color=7F9CF5&background=EBF4FF`,alt:n.name,className:"w-full h-full object-cover"}):"?",e[37]=n,e[38]=I):I=e[38];let C;e[39]!==le||e[40]!==I?(C=t.jsx("div",{className:le,children:I}),e[39]=le,e[40]=I,e[41]=C):C=e[41];let O;e[42]!==n||e[43]!==u?(O=n&&t.jsx("div",{className:`absolute -bottom-0 -left-0 h-4 w-4 rounded-full border-2 border-white dark:border-slate-800 ${u?"bg-green-500":"bg-gray-400"}`}),e[42]=n,e[43]=u,e[44]=O):O=e[44];let U;e[45]!==C||e[46]!==O?(U=t.jsxs("div",{className:"relative",children:[C,O]}),e[45]=C,e[46]=O,e[47]=U):U=e[47];let D;e[48]!==n||e[49]!==a?(D=n?n.name:a("..."),e[48]=n,e[49]=a,e[50]=D):D=e[50];let P;e[51]!==D?(P=t.jsx("span",{className:"max-w-[80px] truncate text-sm font-bold md:max-w-[150px] md:text-lg",children:D}),e[51]=D,e[52]=P):P=e[52];let $;e[53]!==y?($=t.jsx("span",{className:"text-xl leading-none font-black text-red-500 md:text-3xl dark:text-red-400",children:y}),e[53]=y,e[54]=$):$=e[54];let G;e[55]!==P||e[56]!==$?(G=t.jsxs("div",{className:"flex flex-col items-end",children:[P,$]}),e[55]=P,e[56]=$,e[57]=G):G=e[57];let M;e[58]!==ae||e[59]!==U||e[60]!==G?(M=t.jsxs("div",{className:ae,children:[U,G]}),e[58]=ae,e[59]=U,e[60]=G,e[61]=M):M=e[61];let L;e[62]!==E||e[63]!==A||e[64]!==M?(L=t.jsxs("div",{className:"sticky top-0 z-10 mx-auto flex w-full max-w-6xl flex-row items-center justify-between border-b border-slate-200 bg-white/50 p-4 backdrop-blur-sm md:static md:border-none md:bg-transparent dark:border-white/5 dark:bg-black/20",children:[E,A,M]}),e[62]=E,e[63]=A,e[64]=M,e[65]=L):L=e[65];let Q;e[66]!==s.status||e[67]!==a?(Q=s.status==="WAITING_FOR_OPPONENT"&&t.jsxs("div",{className:"animate-in fade-in md:p6 flex flex-1 flex-col items-center justify-center space-y-8 p-4 text-center duration-700 md:p-6",children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"h-24 w-24 rounded-full border-4 border-slate-200 dark:border-slate-800"}),t.jsx("div",{className:"absolute inset-0 h-24 w-24 animate-spin rounded-full border-t-4 border-blue-500"}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("svg",{className:"h-8 w-8 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold md:text-3xl",children:a("Searching for Opponent")}),t.jsx("p",{className:"mt-2 text-slate-500 dark:text-slate-400",children:a("Connecting to global matchmaking server...")})]})]}),e[66]=s.status,e[67]=a,e[68]=Q):Q=e[68];let F;e[69]!==s.status||e[70]!==a?(F=s.status==="STARTING"&&t.jsxs("div",{className:"animate-in zoom-in flex flex-1 flex-col items-center justify-center space-y-6 p-8 text-center duration-500",children:[t.jsx("div",{className:"mb-4 text-6xl md:text-8xl",children:"⚔️"}),t.jsx("h1",{className:"animate-bounce bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-4xl font-black text-transparent md:text-6xl dark:from-blue-400 dark:to-purple-500",children:a("MATCH FOUND!")}),t.jsx("p",{className:"text-xl text-slate-600 dark:text-slate-300",children:a("Get Ready...")})]}),e[69]=s.status,e[70]=a,e[71]=F):F=e[71];let W;e[72]!==b||e[73]!==s.hasAnswered||e[74]!==s.lastRoundResult||e[75]!==s.opponentAnswered||e[76]!==s.status||e[77]!==l||e[78]!==a?(W=(s.status==="QUESTION_ACTIVE"||s.status==="ROUND_RESULT")&&b&&t.jsxs("div",{className:"animate-in slide-in-from-bottom-8 flex flex-1 flex-col space-y-8 p-6 duration-500 md:p-10",children:[t.jsxs("div",{className:"space-y-4 text-center",children:[t.jsx("span",{className:"inline-block rounded-full border border-blue-200 bg-blue-100 px-4 py-1.5 text-xs font-bold tracking-widest text-blue-600 uppercase dark:border-blue-500/20 dark:bg-blue-900/30 dark:text-blue-400",children:b.category}),t.jsx("h2",{className:"text-2xl leading-tight font-bold text-slate-800 md:text-4xl md:leading-tight dark:text-slate-100",children:b.text})]}),t.jsx("div",{className:"mt-auto grid w-full grid-cols-1 gap-3 md:grid-cols-2 md:gap-4",children:b.options.map((z,X)=>{const oe=s.lastRoundResult?.correct_option===z,re=s.status==="ROUND_RESULT";let ne="border-slate-200 bg-white text-slate-700 hover:-translate-y-1 hover:border-blue-500 hover:shadow-lg dark:border-slate-700 dark:bg-slate-800 dark:text-slate-200";return s.hasAnswered&&(ne="border-transparent bg-slate-100 text-slate-400 opacity-50 dark:bg-slate-800/50"),re&&oe&&(ne="scale-[1.02] border-green-600 bg-green-500 text-white shadow-lg shadow-green-500/20 opacity-100"),t.jsx("button",{onClick:()=>l(z),disabled:s.hasAnswered||re,className:`group relative rounded-2xl border-2 p-4 text-left transition-all duration-200 md:p-6 ${ne}`,children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("span",{className:`flex h-8 w-8 items-center justify-center rounded-lg border text-sm font-bold ${re&&oe?"border-white/40 bg-white/20 text-white":"border-slate-200 bg-slate-100 text-slate-500 dark:border-slate-600 dark:bg-slate-700"}`,children:String.fromCharCode(65+X)}),t.jsx("span",{className:"text-lg font-semibold",children:z})]})},X)})}),s.opponentAnswered&&!s.lastRoundResult&&t.jsx("div",{className:"text-center text-sm font-bold text-red-500 animate-pulse",children:a("Opponent has answered!")})]}),e[72]=b,e[73]=s.hasAnswered,e[74]=s.lastRoundResult,e[75]=s.opponentAnswered,e[76]=s.status,e[77]=l,e[78]=a,e[79]=W):W=e[79];let V;e[80]!==te||e[81]!==ee||e[82]!==y||e[83]!==w||e[84]!==s.status||e[85]!==a?(V=s.status==="GAME_OVER"&&t.jsxs("div",{className:"animate-in zoom-in flex flex-1 flex-col items-center justify-center space-y-8 p-8 text-center duration-500",children:[t.jsx("h1",{className:"text-4xl font-black tracking-tight text-slate-900 uppercase md:text-6xl dark:text-white",children:a("GAME OVER")}),t.jsxs("div",{className:"flex w-full items-end justify-center gap-8 md:gap-16",children:[t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:"text-5xl font-black",children:w}),t.jsx("div",{className:"text-sm",children:"YOU"})]}),t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:"text-5xl font-black",children:y}),t.jsx("div",{className:"text-sm",children:"OPPONENT"})]})]}),t.jsx("div",{className:"pt-8 text-3xl font-bold",children:ee?t.jsx("span",{className:"text-green-500",children:"VICTORY!"}):te?t.jsx("span",{className:"text-yellow-500",children:"DRAW"}):t.jsx("span",{className:"text-red-500",children:"DEFEAT"})}),t.jsx("button",{onClick:Ae,className:"rounded-2xl bg-slate-900 px-8 py-4 font-bold text-white shadow-xl hover:scale-105 dark:bg-white dark:text-slate-900",children:a("Back to Dashboard")})]}),e[80]=te,e[81]=ee,e[82]=y,e[83]=w,e[84]=s.status,e[85]=a,e[86]=V):V=e[86];let H;e[87]!==Q||e[88]!==F||e[89]!==W||e[90]!==V?(H=t.jsx("div",{className:"z-10 flex w-full max-w-4xl flex-1 flex-col justify-center p-2 md:p-4",children:t.jsxs("div",{className:"relative flex min-h-[400px] flex-col overflow-hidden rounded-3xl border border-slate-200 bg-white/80 shadow-2xl backdrop-blur-xl transition-all duration-500 md:min-h-[500px] dark:border-white/10 dark:bg-slate-900/60",children:[Q,F,W,V]})}),e[87]=Q,e[88]=F,e[89]=W,e[90]=V,e[91]=H):H=e[91];let J;return e[92]!==L||e[93]!==H?(J=t.jsxs("div",{className:"relative flex min-h-screen flex-col items-center overflow-hidden bg-slate-50 font-sans text-slate-900 transition-colors duration-300 selection:bg-blue-500 selection:text-white dark:bg-slate-950 dark:text-white",children:[Y,B,q,L,H]}),e[92]=L,e[93]=H,e[94]=J):J=e[94],J}function Ae(){return window.location.href="/dashboard"}export{Pe as default};
