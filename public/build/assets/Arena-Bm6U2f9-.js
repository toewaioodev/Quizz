import{u as E,j as e,r as c,H as G,a as A}from"./app-Bwcxkhc9.js";import{c as Q}from"./compiler-runtime-CmEo9VnA.js";import{a as D,C as H,A as M,u as z,b as V}from"./ChannelProvider-BYuXzJVJ.js";import{u as F}from"./useTranslation-BVlf423U.js";/* empty css            */function J(d){const s=Q.c(11),{match:n,ably_key:f}=d,v=E().props.auth.user,b=String(v.id);let i;s[0]!==f||s[1]!==b?(i=new D.Realtime({key:f,clientId:b}),s[0]=f,s[1]=b,s[2]=i):i=s[2];const j=i,o=`match:${n.channel_id}`;let x;s[3]!==n?(x=e.jsx(Y,{match:n}),s[3]=n,s[4]=x):x=s[4];let a;s[5]!==o||s[6]!==x?(a=e.jsx(H,{channelName:o,children:x}),s[5]=o,s[6]=x,s[7]=a):a=s[7];let h;return s[8]!==j||s[9]!==a?(h=e.jsx(M,{client:j,children:a}),s[8]=j,s[9]=a,s[10]=h):h=s[10],h}function Y({match:d}){const s=E().props.auth.user,[n,f]=c.useState("waiting"),[v,b]=c.useState([]),[i,j]=c.useState(d.player1_id===s.id?d.player2:d.player1),[o,x]=c.useState(null),[a,h]=c.useState(5),[u,q]=c.useState(0),[m,C]=c.useState(0),[g,y]=c.useState(!1),[S,k]=c.useState(!1),[_,T]=c.useState(0),{t:l,i18n:O}=F(),{channel:N}=z(`match:${d.channel_id}`,t=>{t.name==="match-found"?(f("starting"),t.data.opponent&&j(t.data.opponent),setTimeout(()=>P(),3e3)):t.name==="new-question"?(x(t.data),h(15),y(!1),k(!1),f("question"),T(r=>r+1)):t.name==="score-update"?t.clientId!==String(s.id)&&C(r=>r+t.data.points):t.name==="player-answered"?t.clientId!==String(s.id)&&k(!0):t.name==="game-over"&&f("result"),b(r=>[...r,t])});V(t=>{console.log("Ably connection state:",t.current)});const p=d.player1_id===s.id,P=async()=>{p&&await w()},w=async()=>{if(_>=5){I();return}try{const t=await A.post("/quiz/generate",{topic:"Science",difficulty:"medium",language:O.language});N.publish("new-question",t.data)}catch(t){console.error("Quiz Error",t)}},I=async()=>{N.publish("game-over",{});let t=null;if(u>m?t=s.id:m>u&&(t=i.id),p)try{await A.post("/match/end",{match_id:d.id,winner_id:t})}catch(r){console.error("End Match Error",r)}};c.useEffect(()=>{let t;return n==="question"&&a>0?t=setInterval(()=>h(r=>r-1),1e3):n==="question"&&a===0&&p&&w(),()=>clearInterval(t)},[n,a,p]),c.useEffect(()=>{if(n==="question"&&g&&S&&p){const t=setTimeout(()=>{w()},1e3);return()=>clearTimeout(t)}},[n,g,S,p]);const R=t=>{if(!g&&(y(!0),N.publish("player-answered",{}),t===o?.correct_answer)){const r=a*10;q($=>$+r),N.publish("score-update",{points:r})}};return e.jsxs("div",{className:"min-h-screen bg-black text-white p-6 flex flex-col items-center font-sans selection:bg-blue-500 selection:text-white",children:[e.jsx(G,{title:"Arena"}),e.jsxs("div",{className:"max-w-4xl w-full flex justify-between items-center mb-12",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-600 flex items-center justify-center text-xl font-bold mb-2 shadow-[0_0_30px_rgba(37,99,235,0.6)] border-2 border-blue-400",children:s.name.charAt(0)}),e.jsx("span",{className:"font-bold text-lg",children:s.name}),e.jsx("span",{className:"text-4xl font-black text-blue-400 mt-2",children:u})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-6xl font-black italic tracking-tighter text-slate-800 drop-shadow-sm",children:"VS"}),n==="question"&&e.jsxs("div",{className:"mt-4 text-2xl font-mono font-bold text-yellow-400 animate-pulse",children:["00:",a<10?`0${a}`:a]}),n==="question"&&e.jsxs("div",{className:"text-sm text-slate-500 mt-2",children:[l("Round")," ",_,"/5"]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[i?e.jsx("div",{className:"w-16 h-16 rounded-full bg-red-600 flex items-center justify-center text-xl font-bold mb-2 shadow-[0_0_30px_rgba(220,38,38,0.6)] border-2 border-red-400",children:i.name?i.name.charAt(0):"?"}):e.jsx("div",{className:"w-16 h-16 rounded-full bg-slate-800 flex items-center justify-center text-xl font-bold mb-2 animate-pulse border border-slate-700",children:"?"}),e.jsx("span",{className:"font-bold text-lg",children:i?i.name:l("Searching...")}),e.jsx("span",{className:"text-4xl font-black text-red-400 mt-2",children:m})]})]}),e.jsxs("div",{className:"w-full max-w-3xl bg-slate-900/80 backdrop-blur-md border border-slate-700/50 rounded-3xl p-8 min-h-[400px] flex flex-col items-center justify-center relative shadow-2xl",children:[n==="waiting"&&!i&&e.jsxs("div",{className:"text-center space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 border-t-4 border-l-4 border-blue-500 rounded-full animate-spin mx-auto"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 bg-blue-500/20 rounded-full blur-xl"})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:l("Searching for Opponent")}),e.jsx("p",{className:"text-slate-400 mt-2",children:l("Connecting to global matchmaking server...")})]})]}),n==="starting"&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("h1",{className:"text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-600 animate-bounce",children:l("MATCH FOUND!")}),e.jsx("p",{className:"text-xl text-slate-300",children:l("Preparing battle...")})]}),n==="question"&&o&&e.jsxs("div",{className:"w-full space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-500/10 text-blue-400 text-xs font-bold uppercase tracking-widest rounded-full border border-blue-500/20",children:o.category||l("General Knowledge")}),e.jsx("h2",{className:"text-3xl font-bold leading-tight md:text-4xl",children:o.question_text})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 w-full",children:o.options.map((t,r)=>e.jsx("button",{onClick:()=>R(t),disabled:g,className:`
                                        p-6 rounded-xl border-2 text-lg font-semibold transition-all duration-200
                                        ${g?t===o.correct_answer?"bg-green-500/20 border-green-500 text-green-400":"bg-slate-800/50 border-slate-700 text-slate-500 opacity-50":"bg-slate-800/50 border-slate-700 hover:border-blue-500 hover:bg-slate-800 hover:scale-[1.02] active:scale-[0.98]"}
                                    `,children:t},r))})]}),n==="result"&&e.jsxs("div",{className:"text-center space-y-8 animate-in zoom-in duration-300",children:[e.jsx("h1",{className:"text-5xl font-black text-white",children:l("GAME OVER")}),e.jsxs("div",{className:"flex justify-center gap-12",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-slate-400 text-sm uppercase font-bold",children:l("You")}),e.jsx("p",{className:`text-6xl font-black ${u>m?"text-green-400":"text-slate-200"}`,children:u})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-slate-400 text-sm uppercase font-bold",children:l("Opponent")}),e.jsx("p",{className:`text-6xl font-black ${m>u?"text-green-400":"text-slate-200"}`,children:m})]})]}),e.jsx("div",{className:"text-2xl font-bold",children:u>m?e.jsx("span",{className:"text-green-400",children:l("VICTORY! +50 PTS")}):u<m?e.jsx("span",{className:"text-red-400",children:l("DEFEAT -10 PTS")}):e.jsx("span",{className:"text-yellow-400",children:l("DRAW")})}),e.jsx("button",{onClick:()=>window.location.href="/dashboard",className:"px-8 py-3 bg-white text-slate-900 font-bold rounded-xl hover:bg-slate-200 transition-colors",children:l("Back to Dashboard")})]})]})]})}export{J as default};
