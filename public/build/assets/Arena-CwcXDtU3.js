import{r as n,u as P,j as e,H as D,a as T}from"./app-715AsBo8.js";import{c as G}from"./compiler-runtime-BE8wk9yF.js";import{u as Q,a as V,b as z,c as Y,d as B,I as q,e as K,f as U,C as W,A as J,g as X,h as Z}from"./ChannelProvider-DJDLJJzD.js";import{u as ee}from"./useTranslation-COeW6Ggc.js";/* empty css            */function te(d,s){const a=typeof d=="object"?d:{channelName:d},m=a.skip,N=Q(a.ablyId),{channel:i}=V(a.ablyId,a.channelName),{connectionError:r,channelError:p}=z(a),x=n.useRef(s);n.useEffect(()=>{x.current=s},[s]);const[f,l]=n.useState(i.state);Y(a,u=>{l(u.current)});const{connectionState:b}=B(i,a.ablyId,m),h=q.includes(b)||K.includes(f)||m;return n.useEffect(()=>h?void 0:((async()=>{await i.presence.enter(x.current)})(),()=>{const k=!q.includes(N.connection.state);["attached","attaching"].includes(i.state)&&k&&i.presence.leave()}),[h,i,N]),{updateStatus:n.useCallback(async u=>{await i.presence.update(u)},[i]),connectionError:r,channelError:p}}function ce(d){const s=G.c(11),{match:a,ably_key:m}=d,N=P().props.auth.user,i=String(N.id);let r;s[0]!==m||s[1]!==i?(r=new U.Realtime({key:m,clientId:i}),s[0]=m,s[1]=i,s[2]=r):r=s[2];const p=r,x=`match:${a.channel_id}`;let f;s[3]!==a?(f=e.jsx(se,{match:a}),s[3]=a,s[4]=f):f=s[4];let l;s[5]!==x||s[6]!==f?(l=e.jsx(W,{channelName:x,children:f}),s[5]=x,s[6]=f,s[7]=l):l=s[7];let b;return s[8]!==p||s[9]!==l?(b=e.jsx(J,{client:p,children:l}),s[8]=p,s[9]=l,s[10]=b):b=s[10],b}function se({match:d}){const s=P().props.auth.user,[a,m]=n.useState("waiting"),[N,i]=n.useState([]),[r,p]=n.useState(d.player1_id===s.id?d.player2:d.player1),[x,f]=n.useState(null),[l,b]=n.useState(5),[h,S]=n.useState(0),[u,k]=n.useState(0),[g,E]=n.useState(!1),[C,_]=n.useState(!1),[A,$]=n.useState(0);n.useEffect(()=>{r&&a==="waiting"&&m("starting")},[r,a]);const{t:c,i18n:R}=ee(),{channel:w}=X(`match:${d.channel_id}`,t=>{t.name==="match-found"?(m("starting"),t.data.opponent&&p(t.data.opponent),setTimeout(()=>L(),3e3)):t.name==="new-question"?(f(t.data),b(15),E(!1),_(!1),m("question"),$(o=>o+1)):t.name==="score-update"?t.clientId!==String(s.id)&&k(o=>o+t.data.points):t.name==="player-answered"?t.clientId!==String(s.id)&&_(!0):t.name==="game-over"&&m("result"),i(o=>[...o,t])});Z(t=>{console.log("Ably connection state:",t.current)});const{presenceData:I}=te(`match:${d.channel_id}`),[v,F]=n.useState(!1);n.useEffect(()=>{const t=(I||[]).some(o=>o.clientId===String(r?.id));F(t)},[I,r]);const j=d.player1_id===s.id,L=async()=>{j&&await y()},y=async()=>{if(A>=5){O();return}try{const t=await T.post("/quiz/generate",{topic:"Science",difficulty:"medium",language:R.language});w.publish("new-question",t.data)}catch(t){console.error("Quiz Error",t)}},O=async()=>{w.publish("game-over",{});let t=null;if(h>u?t=s.id:u>h&&(t=r?.id),j)try{await T.post("/match/end",{match_id:d.id,winner_id:t})}catch(o){console.error("End Match Error",o)}};n.useEffect(()=>{let t;return a==="question"&&l>0?t=setInterval(()=>b(o=>o-1),1e3):a==="question"&&l===0&&j&&y(),()=>clearInterval(t)},[a,l,j]),n.useEffect(()=>{if(a==="question"&&g&&C&&j){const t=setTimeout(()=>{y()},1e3);return()=>clearTimeout(t)}},[a,g,C,j]);const H=t=>{if(!g&&(E(!0),w.publish("player-answered",{}),t===x?.correct_answer)){const o=l*10;S(M=>M+o),w.publish("score-update",{points:o})}};return e.jsxs("div",{className:"min-h-screen bg-slate-100 dark:bg-black text-slate-900 dark:text-white p-6 flex flex-col items-center font-sans selection:bg-blue-500 selection:text-white transition-colors duration-300",children:[e.jsx(D,{title:"Arena"}),e.jsxs("div",{className:"max-w-4xl w-full flex justify-between items-center mb-12",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-600 flex items-center justify-center text-xl font-bold mb-2 shadow-[0_0_30px_rgba(37,99,235,0.6)] border-2 border-blue-400",children:s.name.charAt(0)}),e.jsx("span",{className:"font-bold text-lg",children:s.name}),e.jsx("span",{className:"text-4xl font-black text-blue-400 mt-2",children:h})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-6xl font-black italic tracking-tighter text-slate-800 drop-shadow-sm",children:"VS"}),a==="question"&&e.jsxs("div",{className:"mt-4 text-2xl font-mono font-bold text-yellow-400 animate-pulse",children:["00:",l<10?`0${l}`:l]}),a==="question"&&e.jsxs("div",{className:"text-sm text-slate-500 mt-2",children:[c("Round")," ",A,"/5"]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[r?e.jsxs("div",{className:`relative w-16 h-16 rounded-full flex items-center justify-center text-xl font-bold mb-2 shadow-[0_0_30px_rgba(220,38,38,0.6)] border-2 ${v?"border-green-400 bg-red-600":"border-slate-500 bg-slate-700 grayscale"}`,children:[r.name?r.name.charAt(0):"?",e.jsx("div",{className:`absolute bottom-0 right-0 w-4 h-4 rounded-full border-2 border-slate-900 ${v?"bg-green-500":"bg-slate-500"}`})]}):e.jsx("div",{className:"w-16 h-16 rounded-full bg-slate-800 flex items-center justify-center text-xl font-bold mb-2 animate-pulse border border-slate-700",children:"?"}),e.jsx("span",{className:"font-bold text-lg",children:r?r.name:c("Searching...")}),!v&&r&&e.jsx("span",{className:"text-xs text-red-500 font-bold uppercase tracking-widest",children:c("OFFLINE")}),e.jsx("span",{className:"text-4xl font-black text-red-400 mt-2",children:u})]})]}),e.jsxs("div",{className:"w-full max-w-3xl bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border border-slate-200 dark:border-slate-700/50 rounded-3xl p-8 min-h-[400px] flex flex-col items-center justify-center relative shadow-2xl transition-colors duration-300",children:[a==="waiting"&&!r&&e.jsxs("div",{className:"text-center space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 border-t-4 border-l-4 border-blue-500 rounded-full animate-spin mx-auto"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 bg-blue-500/20 rounded-full blur-xl"})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight text-slate-800 dark:text-white",children:c("Searching for Opponent")}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-2",children:c("Connecting to global matchmaking server...")})]})]}),a==="starting"&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("h1",{className:"text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-400 dark:to-purple-600 animate-bounce",children:c("MATCH FOUND!")}),e.jsx("p",{className:"text-xl text-slate-600 dark:text-slate-300",children:c("Preparing battle...")})]}),a==="question"&&x&&e.jsxs("div",{className:"w-full space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-500/10 text-blue-600 dark:text-blue-400 text-xs font-bold uppercase tracking-widest rounded-full border border-blue-500/20",children:x.category||c("General Knowledge")}),e.jsx("h2",{className:"text-3xl font-bold leading-tight md:text-4xl text-slate-900 dark:text-white",children:x.question_text})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 w-full",children:x.options.map((t,o)=>e.jsx("button",{onClick:()=>H(t),disabled:g,className:`
                                        p-6 rounded-xl border-2 text-lg font-semibold transition-all duration-200
                                        ${g?t===x.correct_answer?"bg-green-500/20 border-green-500 text-green-700 dark:text-green-400":"bg-slate-200 dark:bg-slate-800/50 border-slate-300 dark:border-slate-700 text-slate-400 dark:text-slate-500 opacity-50":"bg-white dark:bg-slate-800/50 border-slate-200 dark:border-slate-700 hover:border-blue-500 hover:bg-slate-50 dark:hover:bg-slate-800 hover:scale-[1.02] active:scale-[0.98] text-slate-800 dark:text-white"}
                                    `,children:t},o))})]}),a==="result"&&e.jsxs("div",{className:"text-center space-y-8 animate-in zoom-in duration-300",children:[e.jsx("h1",{className:"text-5xl font-black text-slate-900 dark:text-white",children:c("GAME OVER")}),e.jsxs("div",{className:"flex justify-center gap-12",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm uppercase font-bold",children:c("You")}),e.jsx("p",{className:`text-6xl font-black ${h>u?"text-green-600 dark:text-green-400":"text-slate-700 dark:text-slate-200"}`,children:h})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm uppercase font-bold",children:c("Opponent")}),e.jsx("p",{className:`text-6xl font-black ${u>h?"text-green-600 dark:text-green-400":"text-slate-700 dark:text-slate-200"}`,children:u})]})]}),e.jsx("div",{className:"text-2xl font-bold",children:h>u?e.jsx("span",{className:"text-green-600 dark:text-green-400",children:c("VICTORY! +50 PTS")}):h<u?e.jsx("span",{className:"text-red-500 dark:text-red-400",children:c("DEFEAT -10 PTS")}):e.jsx("span",{className:"text-yellow-500 dark:text-yellow-400",children:c("DRAW")})}),e.jsx("button",{onClick:()=>window.location.href="/dashboard",className:"px-8 py-3 bg-slate-900 dark:bg-white text-white dark:text-slate-900 font-bold rounded-xl hover:bg-slate-800 dark:hover:bg-slate-200 transition-colors",children:c("Back to Dashboard")})]})]})]})}export{ce as default};
